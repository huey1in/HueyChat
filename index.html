<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/x-icon" href="/src-tauri/icons/favicon2.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HueyChat</title>
    <!-- CSS 模块导入 -->
    <link rel="stylesheet" href="/src/styles/base.css" />
    <link rel="stylesheet" href="/src/styles/loading.css" />
    <link rel="stylesheet" href="/src/styles/titlebar.css" />
    <link rel="stylesheet" href="/src/styles/layout.css" />
    <link rel="stylesheet" href="/src/styles/sidebar.css" />
    <link rel="stylesheet" href="/src/styles/user-card.css" />
    <link rel="stylesheet" href="/src/styles/chat-main.css" />
    <link rel="stylesheet" href="/src/styles/messages.css" />
    <link rel="stylesheet" href="/src/styles/code-blocks.css" />
    <link rel="stylesheet" href="/src/styles/modals.css" />
    <link rel="stylesheet" href="/src/styles/settings-page.css" />
    <link rel="stylesheet" href="/src/styles/forms.css" />
    <link rel="stylesheet" href="/src/styles/buttons.css" />
    <link rel="stylesheet" href="/src/styles/context-menu.css" />
    <link rel="stylesheet" href="/src/styles/notifications.css" />
    <link rel="stylesheet" href="/src/styles/dark-mode.css" />
  </head>
  <body>

    <!-- 窗口控制栏 -->
    <div class="titlebar">
      <div class="traffic-lights" data-tauri-drag-region="false">
        <div class="traffic-light close" id="close-btn" data-tauri-drag-region="false"></div>
        <div class="traffic-light minimize" id="minimize-btn" data-tauri-drag-region="false"></div>
      </div>
      <div class="title" data-tauri-drag-region>Chat</div>
    </div>
    
    <!-- 启动动画 -->
    <div id="loading-screen" class="blur-background">
      <div class="loading-container">
        <div class="loading-logo">
          <div class="logo-text">Welcome!</div>
          <div class="loading-spinner"></div>
        </div>
        <div class="loading-text">正在启动中...</div>
      </div>
    </div>
    
    <!-- 聊天应用主体 -->
    <div id="app">
      <!-- 左侧聊天列表 -->
      <div class="chat-sidebar">
        <div class="sidebar-header">
          <h2>Chat now!</h2>
          <button class="new-chat-btn" title="新建聊天">+</button>
        </div>
        <div class="chat-list">
          <!-- 聊天列表 -->
        </div>
        
        <!-- 用户信息卡片 -->
        <div class="user-card" id="user-card" onclick="showLoginModal()" onmouseover="window.showUserMenu && window.showUserMenu()" onmouseenter="window.userCardHovered = true" onmouseleave="window.userCardHovered = false; setTimeout(() => { if (!window.userMenuHovered) { window.hideUserMenu && window.hideUserMenu(); } }, 200)">
          <div class="user-info">
            <div class="user-name" id="user-name">未登录</div>
            <div class="user-status" id="user-status">点击登录或查看信息</div>
            <div class="user-credits" id="user-credits" style="display: none;">积分: 0</div>
          </div>
          <div class="user-action">›</div>
        </div>
      </div>
      
      <!-- 右侧聊天窗口 -->
      <div class="chat-main">
        
        <!-- 聊天消息区域 -->
        <div class="chat-messages">
          <!-- 消息将 -->
        </div>
        
        <!-- 消息输入区域 -->
        <div class="chat-input">
          <select id="model-select" title="选择AI模型">
            <option value="">加载模型中...</option>
          </select>
          <input type="text" id="message-input" placeholder="输入消息..." />
          <button id="send-button" type="button">发送</button>
        </div>
      </div>

      <!-- 设置页面 -->
      <div class="settings-page" id="settings-page" style="display: none;">
        <div class="settings-header">
          <button class="back-btn" onclick="closeSettingsPage()" title="返回">‹</button>
          <h2>设置</h2>
        </div>
        <div class="settings-content">
          <div class="settings-section">
            <div class="form-group">
              <span class="setting-label">深色模式</span>
              <label class="toggle-switch">
                <input type="checkbox" id="dark-mode-checkbox" onchange="window.handleDarkModeToggle && window.handleDarkModeToggle()" />
                <span class="toggle-slider"></span>
              </label>
            </div>
          </div>
        </div>
      </div>

      <!-- 关于页面 -->
      <div class="settings-page" id="about-page" style="display: none;">
        <div class="settings-header">
          <button class="back-btn" onclick="closeAboutPage()" title="返回">‹</button>
          <h2>关于</h2>
        </div>
        <div class="settings-content">
          <div class="settings-section">
            <div class="about-row">
              <div class="form-group about-group">
                <span class="setting-label">当前版本</span>
                <span class="version-number" id="current-version">v1.0.0</span>
              </div>
              <button class="check-update-btn" onclick="window.checkForUpdates && window.checkForUpdates()" title="检查更新">检查</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 系统提示词设置模态框 -->
    <div id="prompt-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>设置系统提示词</h3>
          <button class="modal-close" onclick="closePromptModal()">×</button>
        </div>
        <div class="modal-body">
          <textarea id="prompt-textarea" placeholder="输入系统提示词，用于定义AI的角色和行为方式...&#10;&#10;例如：你是一个专业的编程助手，请用简洁明了的方式回答技术问题。" rows="6"></textarea>
          <p class="modal-tip">留空表示使用默认的AI助手角色</p>
        </div>
        <div class="modal-footer">
          <button class="btn-secondary" onclick="closePromptModal()">取消</button>
          <button class="btn-primary" onclick="savePrompt()">确定</button>
        </div>
      </div>
    </div>

    <!-- 右键上下文菜单 -->
    <div id="context-menu" class="context-menu">
      <div class="menu-item" onclick="editChatPrompt()">
        <span class="menu-text">修改设定</span>
      </div>
      <div class="menu-item menu-item-danger" onclick="contextDeleteChat()">
        <span class="menu-text">删除聊天</span>
      </div>
    </div>

    <!-- 用户菜单 -->
    <div id="user-menu" class="user-menu" onmouseenter="window.userMenuHovered = true" onmouseleave="window.userMenuHovered = false; window.hideUserMenu && window.hideUserMenu()">
      <div class="menu-item" data-menu-item="about" onclick="window.handleUserMenuAbout && window.handleUserMenuAbout()">
        <span class="menu-text">关于</span>
      </div>
      <div class="menu-item" data-menu-item="settings" onclick="window.handleUserMenuSettings && window.handleUserMenuSettings()">
        <span class="menu-text">设置</span>
      </div>
    </div>

    <!-- 确认删除模态框 -->
    <div id="confirm-modal" class="modal">
      <div class="modal-content confirm-modal-content">
        <div class="modal-header">
          <h3>确认删除</h3>
        </div>
        <div class="modal-body">
          <p id="confirm-message">确定要删除这个聊天吗？</p>
        </div>
        <div class="modal-footer">
          <button class="btn-secondary" onclick="closeConfirmModal()">取消</button>
          <button class="btn-danger" onclick="confirmDelete()">删除</button>
        </div>
      </div>
    </div>

    <!-- 用户信息模态框 -->
    <div id="user-profile-modal" class="modal">
      <div class="modal-content user-profile-modal-content">
        <div class="modal-header">
          <h3>用户登录</h3>
          <button class="close-btn" onclick="closeUserProfileModal()">×</button>
        </div>
        <div class="modal-body">

          <!-- 登录表单 -->
          <div id="login-form" class="form-section" style="display: none;">
            <div class="form-group">
              <label>用户名</label>
              <input type="text" id="login-username" placeholder="请输入用户名" />
            </div>
            <div class="form-group">
              <label>密码</label>
              <input type="password" id="login-password" placeholder="请输入密码" />
            </div>
            <div class="form-group">
              <label class="checkbox-label">
                <input type="checkbox" id="remember-password" />
                <span class="checkbox-text">记住密码</span>
              </label>
            </div>
            <div class="form-buttons">
              <button class="btn-primary" onclick="performLogin()">登录</button>
            </div>
            <div class="form-footer">
              <span class="form-link-text">还没有账号？</span>
              <a href="#" class="form-link" onclick="showRegisterForm()">立即注册</a>
            </div>
          </div>

          <!-- 注册表单 -->
          <div id="register-form" class="form-section" style="display: none;">
            <div class="form-group">
              <label>用户名</label>
              <input type="text" id="register-username" placeholder="请输入用户名" />
            </div>
            <div class="form-group">
              <label>密码</label>
              <input type="password" id="register-password" placeholder="请输入密码" />
              <div class="password-strength" id="password-strength" style="display: none;">
                <div class="strength-bar">
                  <div class="strength-fill" id="strength-fill"></div>
                </div>
                <div class="strength-text" id="strength-text">密码强度: 弱</div>
              </div>
            </div>
            <div class="form-group">
              <label>确认密码</label>
              <input type="password" id="register-confirm-password" placeholder="请再次输入密码" />
            </div>
            <div class="form-buttons">
              <button class="btn-primary" onclick="performRegister()">注册</button>
            </div>
            <div class="form-footer">
              <span class="form-link-text">已有账号？</span>
              <a href="#" class="form-link" onclick="showLoginForm()">立即登录</a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 退出登录确认模态框 -->
    <div id="logout-confirm-modal" class="modal">
      <div class="modal-content confirm-modal-content">
        <div class="modal-header">
          <h3>确认退出登录</h3>
        </div>
        <div class="modal-body">
          <p>确定要退出登录吗？</p>
        </div>
        <div class="modal-footer">
          <button class="btn-secondary" onclick="closeLogoutModal()">取消</button>
          <button class="btn-danger" onclick="confirmLogout()">退出登录</button>
        </div>
      </div>
    </div>

    <!-- 通知容器 -->
    <div id="notification-container" class="notification-container"></div>

    <script type="module" src="/src/js/main.js"></script>
  </body>
</html>